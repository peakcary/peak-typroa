# 表格组件OBJECT类型列对齐和省略号修复记录

## 修改时间
2025-07-11 10:14:54

## 修改文件
`/src/components/jsonSchema/Tables_new/commonTable.vue`

## 问题描述
OBJECT类型列设置了 `"align": "left"` 但没有正确显示左对齐，同时文本超出时没有显示省略号。

## 数据格式示例
需要正确处理的数据格式：
```javascript
{
  "value": {
    "showValue": "EL-202507-0015",
    "value": "1942877278329507840",
    "metaId": "1940312483642347549"
  }
}
```

## 具体修改内容

### 修改位置
**行号**: 943-957行（OBJECT类型渲染逻辑）

### 修改前
```javascript
} else if (col.widget === "OBJECT") {
  // 恢复OBJECT渲染，但简化版本（不包含链接功能）
  baseCol.slots = {
    default: ({ row }) => {
      if (isUnmounting.value || tableData.componentResetting)
        return h("span", "");
      try {
        const value = row[col.columnName]?.value || "";
        return h("span", value.showValue || "");
      } catch (error) {
        console.warn("OBJECT render error:", error);
        return h("span", "");
      }
    },
  };
}
```

### 修改后
```javascript
} else if (col.widget === "OBJECT") {
  baseCol.slots = {
    default: createRenderFunction(({ row, column }) => {
      const cellData = row[column.columnName] || {};
      const value = cellData.value || {};
      const displayValue = value.showValue || "";
      
      // 处理 hyperLink 的情况
      if (cellData.hyperLink) {
        return h(ElLink, {
          type: "primary",
          underline: false,
          class: "table-cell-link",
          style: {
            width: "100%",
            textAlign: column.align || "left",
            overflow: "hidden",
            textOverflow: "ellipsis",
            whiteSpace: "nowrap",
            display: "inline-block",
            verticalAlign: "middle",
            lineHeight: "40px"
          },
          onClick: (e) => {
            e.stopPropagation();
            handleAction(cellData.hyperLink);
          }
        }, displayValue);
      }

      // 普通 OBJECT 显示
      return h("span", {
        style: {
          width: "100%",
          textAlign: column.align || "left",
          overflow: "hidden",
          textOverflow: "ellipsis",
          whiteSpace: "nowrap",
          display: "inline-block",
          verticalAlign: "middle",
          lineHeight: "40px"
        },
        title: displayValue  // 鼠标悬停显示完整内容
      }, displayValue);
    }, col),
  };
}
```

## 修复功能详解

### 1. 对齐支持
- **左对齐**: `"align": "left"`
- **居中对齐**: `"align": "center"`
- **右对齐**: `"align": "right"`
- **默认对齐**: 未设置时默认左对齐

### 2. 省略号显示
- `overflow: hidden` - 隐藏超出内容
- `textOverflow: "ellipsis"` - 显示省略号
- `whiteSpace: "nowrap"` - 不换行

### 3. 用户体验优化
- **鼠标悬停提示**: 添加 `title` 属性显示完整内容
- **垂直居中**: 保持与其他类型列一致的垂直对齐
- **统一样式**: 使用统一的行高和样式规范

### 4. hyperLink 支持
- 支持 OBJECT 类型数据的超链接功能
- 保持对齐和省略号样式
- 正确处理点击事件

## 支持的数据类型

### 普通 OBJECT 数据
```javascript
{
  "value": {
    "showValue": "显示文本",
    "value": "实际值",
    "metaId": "元数据ID"
  }
}
```

### 带 hyperLink 的 OBJECT 数据
```javascript
{
  "value": {
    "showValue": "可点击文本",
    "value": "实际值"
  },
  "hyperLink": {
    "type": "postMessage",
    "postData": { ... }
  }
}
```

## 技术要点
- 使用 `createRenderFunction` 创建缓存的渲染函数
- 通过 `column.align` 获取列配置的对齐方式
- 使用 CSS 样式实现文本对齐和省略号
- 保持与其他类型列的样式一致性

## 影响范围
仅影响 OBJECT 类型列的显示，修复对齐和省略号问题，同时增强了 hyperLink 支持。

## 测试建议
1. 测试不同对齐方式的显示效果
2. 测试长文本的省略号显示
3. 测试鼠标悬停的完整内容显示
4. 验证带 hyperLink 的 OBJECT 数据点击功能