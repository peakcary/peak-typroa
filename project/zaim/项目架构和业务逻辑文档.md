# 自在招聘项目架构和业务逻辑文档

## 项目概述

**项目名称**: 自在招聘 (zaiwork)  
**项目描述**: 基于专业测评为核心，AI 驱动的下一代智能招聘平台  
**技术栈**: Vue 3 + UniApp + TypeScript + Pinia + UnoCSS  
**支持平台**: H5、微信小程序、App (iOS/Android)、支付宝小程序、百度小程序、字节跳动小程序等

## 1. 整体架构分析

### 1.1 项目结构

```
zai-m/
├── pages/                    # 主包页面
│   ├── home/                # 首页
│   ├── resume/              # 简历管理
│   ├── zaier/               # AI测评
│   ├── jobSearch/           # 求职搜索
│   ├── my/                  # 个人中心
│   └── ...
├── pagesA/                  # 分包A(用户功能)
│   ├── user/               # 用户相关
│   ├── agreement/          # 协议页面
│   ├── messages/           # 消息中心
│   └── ...
├── pagesB/                  # 分包B(企业功能)
│   ├── certification/      # 认证相关
│   └── tobPromotion/       # ToB推广
├── components/              # 公共组件
├── store/                   # 状态管理
├── services/                # API服务层
├── utils/                   # 工具函数
├── constants/               # 常量定义
├── hooks/                   # Vue3组合式API
├── types/                   # TypeScript类型定义
└── static/                  # 静态资源
```

### 1.2 技术栈详情

- **框架**: Vue 3 + UniApp (跨平台开发)
- **状态管理**: Pinia (Vue 3推荐的状态管理)
- **UI样式**: UnoCSS (原子化CSS)
- **类型检查**: TypeScript
- **构建工具**: Vite
- **包管理**: PNPM

## 2. 核心功能模块

### 2.1 用户认证系统

**实现文件**: `pages/user/index.vue`, `hooks/useLoginStatus.ts`

**支持的登录方式**:
- 手机验证码登录
- 微信一键登录 (App端)
- 本机号码一键登录 (App端)

**认证流程**:
```
用户选择登录方式 → 身份验证 → 获取Token → 存储本地 → 更新用户状态
```

### 2.2 简历管理系统

**核心页面**: `pages/resume/index.vue`  
**编辑页面**: `pages/resume/edit/` 目录下各子页面

**功能特性**:
- **个人信息管理**: 基本信息、联系方式、求职意向
- **工作经历**: 多段工作经验添加和编辑
- **项目经历**: 项目描述和技能展示
- **教育背景**: 学历信息管理
- **专业技能**: 技能标签和熟练度
- **AI简历优化**: 基于AI的简历润色和建议
- **简历导出**: 支持多种格式导出
- **简历模板**: 多种模板选择

**数据流程**:
```
API获取 → resumeUtil.parse() → Store缓存 → 组件展示 → 用户编辑 → resumeUtil.stringify() → API保存
```

### 2.3 AI测评系统

**核心页面**: `pages/zaier/index.vue`, `pages/zaier/certification/`

**测评流程**:
1. **专业领域选择**: 从预定义的领域树中选择专业方向
2. **AI面试**: 基于WebRTC的音视频交互
3. **实时分析**: AI分析用户回答和表现
4. **生成报告**: 详细的能力评估报告

**技术实现**:
- **音视频采集**: 使用uni-app的camera和record组件
- **实时通信**: WebRTC技术栈
- **设备权限管理**: 跨平台的权限申请和处理
- **数据上传**: 音频文件的压缩和上传

### 2.4 智能匹配系统

**实现页面**: `pages/match/`, `pages/jobs/`

**匹配算法**:
- 基于用户简历信息
- 结合AI测评结果
- 综合求职偏好设置
- 地理位置优化

**交互机制**:
- **感兴趣**: 向企业表达求职意向
- **不感兴趣**: 移除推荐，优化算法
- **职位收藏**: 保存感兴趣的职位
- **查看详情**: 完整的职位和企业信息

### 2.5 求职工具集

**快速求职**: `pages/jobSearch/index.vue`
- 职位搜索和筛选
- 地区、薪资、经验等多维度筛选
- 行业和职能分类浏览

**求职宝典**: `pages/jobguide/index.vue`  
- 求职技巧和指导
- 面试准备和建议

## 3. 状态管理架构

### 3.1 Store模块设计

使用Pinia进行状态管理，按业务模块划分：

```typescript
// 用户Store - store/user.ts
interface UserState {
  isReady: boolean;           // 数据加载状态
  userinfo: Userinfo;         // 用户基本信息
  sharerPin: string;          // 分享来源
  fieldList: FieldList;       // 用户专业领域
  wxAdInfo: WxAdInfo;         // 广告跟踪信息
}

// 简历Store - store/resume.ts
interface ResumeState {
  resume: Resume | null;      // 缓存的简历数据
}

// 专业领域Store - store/field.ts
interface FieldState {
  fieldList: Field[];         // 所有专业领域
  fieldMap: FieldMap;         // 扁平化映射
}

// 页面控制Store - store/pageWrapper.ts  
interface PageWrapperState {
  loginVisible: boolean;      // 登录弹窗状态
  random: number;            // 强制更新标识
}
```

### 3.2 数据流设计

**单向数据流**:
```
用户操作 → Action → Mutation → State → 组件更新
```

**异步数据流**:
```
组件调用 → Service API → 数据转换 → Store更新 → 界面响应
```

### 3.3 缓存策略

- **内存缓存**: Store作为一级缓存
- **本地存储**: Token、用户Pin等关键信息
- **接口缓存**: 静态数据如城市列表、行业分类
- **懒加载**: 按需加载减少初始化时间

## 4. API服务层设计

### 4.1 服务模块划分

```typescript
// services/index.ts - 核心服务集合
// services/account.ts - 账户相关
// services/certification.ts - 认证测评相关  
// services/job.ts - 职位相关
// services/zaier.ts - 匹配相关
// services/activity.ts - 活动相关
// services/entity.ts - 企业相关
```

### 4.2 请求封装

**统一请求处理**: `utils/request.ts`
- 自动Token附加
- 统一错误处理
- 登录状态检查
- 响应数据转换

### 4.3 主要API接口

**用户相关**:
- `queryUserInfo()` - 获取用户信息
- `updateUn()` - 更新用户名
- `updateMobile()` - 更新手机号

**简历相关**:
- `queryResume()` - 获取简历
- `updateResume()` - 更新简历
- `optimizeResume()` - AI优化简历
- `polishResume()` - 简历润色

**测评相关**:
- `queryAIExamList()` - 获取测评列表
- `createInterviewExam()` - 创建AI测评
- `queryInterviewQuestion()` - 获取测评题目
- `endAIInterview()` - 结束测评
- `queryCertificationReport()` - 获取测评报告

**职位匹配**:
- `queryMatchWorkList()` - 获取匹配职位
- `queryWorkList()` - 搜索职位
- `createWorkMatch()` - 创建匹配
- `updateWorkInteresting()` - 表达兴趣
- `updateWorkReject()` - 拒绝推荐

## 5. 页面路由和导航

### 5.1 TabBar导航

```json
{
  "tabBar": {
    "list": [
      { "pagePath": "pages/resume/index", "text": "简历优化" },
      { "pagePath": "pages/zaier/index", "text": "AI 测评" },
      { "pagePath": "pages/home/index", "text": "首页" },
      { "pagePath": "pages/jobSearch/index", "text": "快速求职" },
      { "pagePath": "pages/my/index", "text": "我的" }
    ]
  }
}
```

### 5.2 页面分包策略

- **主包**: 核心功能页面，用户最常访问
- **分包A**: 用户相关功能，如邀请、协议、消息等
- **分包B**: ToB功能，企业推广等
- **预加载**: 首页预加载分包A提升用户体验

### 5.3 路由守卫

通过 `useAuthTrigger` Hook实现：
- 未登录用户访问需要认证的页面时自动弹出登录界面
- 登录成功后自动跳转到目标页面

## 6. 组件系统设计

### 6.1 组件分层

**业务组件** (components/):
- 与业务逻辑紧密相关
- 具有特定的功能场景
- 如 `certification-field-list.vue`, `pay-popup.vue`

**UI组件**:
- 纯展示组件，无业务逻辑
- 通过props接收数据
- 通过事件向外传递交互

**页面组件** (pages/):
- 完整的页面级组件
- 整合业务逻辑和UI展示
- 管理页面状态和数据流

### 6.2 核心公共组件

- **PageWrapper**: 统一页面布局和导航
- **LoginCheck**: 登录状态检查
- **CitySelect**: 城市选择器
- **IndustrySelect**: 行业选择器
- **CharCounter**: 字符计数器
- **LoadMore**: 列表加载更多

## 7. 工具函数和常量

### 7.1 核心工具函数

**请求工具** (`utils/request.ts`):
- Promise化的统一请求封装
- 自动Token管理
- 错误处理和重试机制

**数据处理工具**:
- `resumeUtil` - 简历数据序列化/反序列化
- `cityUtil` - 城市数据处理
- `tokenUtil` - Token存储管理

**业务工具**:
- `guideUtil` - 引导页状态管理
- `wxShare` - 微信分享功能
- `getLocation` - 地理位置获取

### 7.2 常量定义

**业务常量** (`constants/index.ts`):
- `IS_HIRE` - 平台类型标识
- `EDUCATION_MAP` - 学历映射
- `EXPERIENCE_MAP` - 经验映射
- `ZAIER_LEVEL_LIST` - 测评级别

**数据常量**:
- `CITY_LIST` - 全国城市数据
- `HOT_CITY_LIST` - 热门城市
- `FIELD_TREE` - 专业领域树

## 8. 跨平台适配

### 8.1 平台特性处理

**条件编译**:
```javascript
// #ifdef APP-PLUS
// App端特有逻辑
// #endif

// #ifdef MP-WEIXIN  
// 微信小程序特有逻辑
// #endif

// #ifdef H5
// H5端特有逻辑
// #endif
```

**权限管理**:
- App端使用原生权限API
- 小程序使用授权API
- H5端使用浏览器API

### 8.2 设备适配

**音视频功能**:
- App端使用原生camera和record组件
- 小程序使用相应的API
- H5端使用WebRTC

**存储策略**:
- 统一使用uni.setStorageSync
- 不同平台自动适配对应的存储机制

## 9. 性能优化策略

### 9.1 加载优化

- **分包加载**: 减少主包体积
- **预加载规则**: 首页预加载常用分包
- **懒加载**: 图片和非关键资源按需加载
- **代码分割**: 路由级别的代码分割

### 9.2 数据优化

- **缓存策略**: 多层缓存减少网络请求
- **数据预取**: 提前加载可能需要的数据
- **增量更新**: 只传输变化的数据
- **压缩传输**: 数据压缩减少传输量

### 9.3 渲染优化

- **虚拟列表**: 长列表性能优化
- **图片优化**: WebP格式，尺寸适配
- **CSS优化**: UnoCSS原子化减少样式冗余

## 10. 开发和部署

### 10.1 开发环境

**启动项目**:
```bash
# 安装依赖
pnpm install

# H5开发
npm run dev:h5

# 微信小程序开发  
npm run dev:mp-weixin

# App开发
npm run dev:app
```

**环境配置**:
- 开发环境API代理到 `http://dev.zizai.work/`
- 生产环境使用正式域名

### 10.2 构建配置

**Vite配置** (`vite.config.ts`):
- UnoCSS插件集成
- 开发代理配置
- 生产构建优化

**UniApp配置** (`manifest.json`):
- 多平台适配配置
- 权限申请配置
- 第三方SDK配置

### 10.3 项目脚本

```json
{
  "scripts": {
    "gen:title": "node scripts/generate-page-titles.js",  
    "switch-zp": "node scripts/switchMini.js type=zp",
    "switch-zs": "node scripts/switchMini.js type=zs"
  }
}
```

## 11. 总结

### 11.1 架构特点

1. **跨平台统一**: 一套代码适配多个平台
2. **模块化设计**: 清晰的模块划分和职责分离
3. **类型安全**: TypeScript提供完整类型检查
4. **响应式架构**: Vue 3响应式系统确保数据一致性
5. **性能优化**: 多层次的性能优化策略

### 11.2 技术优势

- **开发效率**: UniApp跨平台开发减少重复工作
- **维护性**: 良好的代码组织和模块化设计
- **扩展性**: 清晰的架构便于功能扩展
- **用户体验**: 原生般的交互体验

### 11.3 适用场景

此架构适合于：
- 复杂的业务应用开发
- 需要跨平台发布的移动应用
- 有实时交互需求的应用
- 需要AI能力集成的应用

## 12. 需求开发指南

### 12.1 新功能开发流程

1. **需求分析**: 明确功能边界和用户场景
2. **技术设计**: 确定API接口、数据结构、页面流程
3. **创建分支**: 从master创建功能分支
4. **开发实现**: 
   - 新增API服务 (services/)
   - 创建页面组件 (pages/)
   - 更新状态管理 (store/)
   - 添加类型定义 (types/)
5. **测试验证**: 多平台测试确保功能正常
6. **代码审查**: 代码质量和规范检查
7. **合并发布**: 合并到主分支并部署

### 12.2 常见开发场景

**新增页面**:
1. 在pages.json中配置路由
2. 创建页面组件文件
3. 添加导航和跳转逻辑
4. 更新页面标题映射

**新增API接口**:
1. 在对应service文件中添加接口方法
2. 更新TypeScript类型定义
3. 在组件中调用接口
4. 处理loading和错误状态

**状态管理扩展**:
1. 在对应store中添加state字段
2. 添加相应的actions和getters
3. 在组件中使用store数据
4. 确保数据持久化策略

通过本文档，开发者可以快速理解项目架构，高效地进行需求开发和功能扩展。