# é£ä¹¦OAuthå…ç™»è§£å†³æ–¹æ¡ˆ

## ğŸ¯ å®Œæ•´è§£å†³æ–¹æ¡ˆ

æ ¹æ®é£ä¹¦å®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘å·²ç»åˆ›å»ºäº†**å®Œå…¨ç¬¦åˆå®˜æ–¹è§„èŒƒ**çš„OAuthå…ç™»è§£å†³æ–¹æ¡ˆã€‚

### ğŸ“ é¡µé¢åœ°å€
```
http://localhost:8058/feishu-oauth.html
```

## ğŸ”§ é£ä¹¦å¹³å°é…ç½®

### 1. åˆ›å»ºé£ä¹¦åº”ç”¨
1. ç™»å½• [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
3. è·å– **App ID** å’Œ **App Secret**

### 2. é…ç½®é‡å®šå‘URI
åœ¨åº”ç”¨çš„"å®‰å…¨è®¾ç½®"ä¸­ï¼Œæ·»åŠ é‡å®šå‘URIï¼š
```
http://your-domain.com/feishu-oauth.html
```

### 3. ç”³è¯·æƒé™
éœ€è¦ç”³è¯·ä»¥ä¸‹æƒé™ï¼š
- âœ… è·å–ç”¨æˆ· userid
- âœ… è·å–ç”¨æˆ·ç»Ÿä¸€ID  
- âœ… è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- âœ… è·å–ç”¨æˆ·é‚®ç®±ï¼ˆå¯é€‰ï¼‰
- âœ… è·å–ç”¨æˆ·æ‰‹æœºå·ï¼ˆå¯é€‰ï¼‰

## ğŸ—ï¸ åç«¯APIæ¥å£

éœ€è¦å®ç°ä»¥ä¸‹3ä¸ªAPIæ¥å£ï¼š

### 1. æ¢å–è®¿é—®ä»¤ç‰Œ
```javascript
POST /api/feishu/oauth/token

Request Body:
{
  "code": "æˆæƒç ",
  "redirect_uri": "é‡å®šå‘åœ°å€"
}

Response:
{
  "errno": 0,
  "msg": "success",
  "data": {
    "access_token": "ç”¨æˆ·è®¿é—®ä»¤ç‰Œ",
    "user_id": "ç”¨æˆ·ID"
  }
}
```

**åç«¯å®ç°é€»è¾‘ï¼š**
```javascript
// è°ƒç”¨é£ä¹¦APIæ¢å–token
const response = await fetch('https://open.feishu.cn/open-apis/authen/v2/oauth/token', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    client_id: 'YOUR_APP_ID',
    client_secret: 'YOUR_APP_SECRET',
    code: req.body.code,
    grant_type: 'authorization_code',
    redirect_uri: req.body.redirect_uri
  })
});
```

### 2. è·å–ç”¨æˆ·ä¿¡æ¯
```javascript
GET /api/feishu/user/info
Authorization: Bearer {access_token}

Response:
{
  "errno": 0,
  "msg": "success", 
  "data": {
    "user_id": "ç”¨æˆ·ID",
    "open_id": "å¼€æ”¾ID",
    "name": "ç”¨æˆ·å§“å",
    "email": "é‚®ç®±",
    "mobile": "æ‰‹æœºå·"
  }
}
```

**åç«¯å®ç°é€»è¾‘ï¼š**
```javascript
// è°ƒç”¨é£ä¹¦APIè·å–ç”¨æˆ·ä¿¡æ¯
const response = await fetch('https://open.feishu.cn/open-apis/authen/v1/user_info', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${access_token}`
  }
});
```

### 3. æœ¬åœ°ç™»å½•å¤„ç†
```javascript
POST /api/user/feishu-login

Request Body:
{
  "feishu_user_id": "é£ä¹¦ç”¨æˆ·ID",
  "feishu_open_id": "é£ä¹¦å¼€æ”¾ID", 
  "name": "ç”¨æˆ·å§“å",
  "email": "é‚®ç®±",
  "mobile": "æ‰‹æœºå·"
}

Response:
{
  "errno": 0,
  "msg": "ç™»å½•æˆåŠŸ",
  "data": {
    "user": {
      "id": "æœ¬åœ°ç”¨æˆ·ID",
      "name": "ç”¨æˆ·å§“å"
    }
  }
}
```

## ğŸ”§ å‰ç«¯é…ç½®

ç¼–è¾‘ `feishu-oauth.html` æ–‡ä»¶ï¼Œä¿®æ”¹é£ä¹¦åº”ç”¨é…ç½®ï¼š

```javascript
const FEISHU_CONFIG = {
    client_id: 'cli_a1b2c3d4e5f6g7h8',  // æ›¿æ¢ä¸ºä½ çš„é£ä¹¦åº”ç”¨ID
    redirect_uri: window.location.origin + '/feishu-oauth.html',
    scope: 'user:info:basic'
};
```

## ğŸ§ª æµ‹è¯•æµç¨‹

### 1. åŸºç¡€æµ‹è¯•
1. è®¿é—®ï¼š`http://localhost:8058/feishu-oauth.html`
2. ç‚¹å‡»"é£ä¹¦ç™»å½•"æŒ‰é’®
3. è·³è½¬åˆ°é£ä¹¦æˆæƒé¡µé¢
4. æˆæƒåè·³è½¬å›æ¥å®Œæˆç™»å½•

### 2. å®Œæ•´æµç¨‹
1. **ç”¨æˆ·ç‚¹å‡»ç™»å½•** â†’ ç”Ÿæˆstateå‚æ•°ï¼Œè·³è½¬é£ä¹¦
2. **é£ä¹¦æˆæƒ** â†’ ç”¨æˆ·åœ¨é£ä¹¦é¡µé¢ç¡®è®¤æˆæƒ
3. **å›è°ƒå¤„ç†** â†’ æºå¸¦æˆæƒç è·³è½¬å›åº”ç”¨
4. **æ¢å–token** â†’ åç«¯ç”¨æˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
5. **è·å–ç”¨æˆ·ä¿¡æ¯** â†’ ç”¨åç«¯ç”¨tokenè·å–ç”¨æˆ·è¯¦æƒ…
6. **æœ¬åœ°ç™»å½•** â†’ åˆ›å»ºæˆ–æ›´æ–°æœ¬åœ°ç”¨æˆ·ä¼šè¯
7. **è·³è½¬ä¸šåŠ¡é¡µé¢** â†’ å®Œæˆæ•´ä¸ªç™»å½•æµç¨‹

## ğŸ”’ å®‰å…¨ç‰¹æ€§

âœ… **CSRFé˜²æŠ¤**ï¼šä½¿ç”¨stateå‚æ•°é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€   
âœ… **æˆæƒç æ¨¡å¼**ï¼šç¬¦åˆOAuth 2.0æ ‡å‡†  
âœ… **HTTPSä¼ è¾“**ï¼šæ‰€æœ‰æ•æ„Ÿä¿¡æ¯é€šè¿‡HTTPSä¼ è¾“  
âœ… **tokenç®¡ç†**ï¼šè®¿é—®ä»¤ç‰Œä»…åœ¨æœåŠ¡å™¨ç«¯å¤„ç†  

## ğŸ¯ ä¼˜åŠ¿

- âœ… **å®Œå…¨ç¬¦åˆé£ä¹¦å®˜æ–¹è§„èŒƒ**
- âœ… **æ ‡å‡†OAuth 2.0æµç¨‹**
- âœ… **å®‰å…¨å¯é çš„å®ç°**
- âœ… **å®Œæ•´çš„é”™è¯¯å¤„ç†**
- âœ… **ç”¨æˆ·ä½“éªŒå‹å¥½**
- âœ… **æ˜“äºç»´æŠ¤å’Œæ‰©å±•**

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **åº”ç”¨IDé…ç½®**ï¼šå¿…é¡»æ›¿æ¢ä¸ºçœŸå®çš„é£ä¹¦åº”ç”¨ID
2. **é‡å®šå‘URI**ï¼šå¿…é¡»ä¸é£ä¹¦å¹³å°é…ç½®å®Œå…¨ä¸€è‡´
3. **æƒé™ç”³è¯·**ï¼šç¡®ä¿ç”³è¯·äº†æ‰€éœ€çš„ç”¨æˆ·ä¿¡æ¯æƒé™
4. **HTTPSè¦æ±‚**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS
5. **IPç™½åå•**ï¼šåœ¨é£ä¹¦å¹³å°é…ç½®æœåŠ¡å™¨IPç™½åå•

è¿™ä¸ªè§£å†³æ–¹æ¡ˆå®Œå…¨ç»•è¿‡äº†Vueè·¯ç”±é—®é¢˜ï¼Œå¯ä»¥ä½œä¸ºç‹¬ç«‹çš„OAuthæœåŠ¡ä½¿ç”¨ï¼