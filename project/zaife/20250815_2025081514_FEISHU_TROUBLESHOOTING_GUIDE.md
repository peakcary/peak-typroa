# é£ä¹¦é›†æˆæ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

**é—®é¢˜æè¿°**ï¼šè®¿é—® `/feishu/auth` é¡µé¢æ—¶æ˜¾ç¤º"è®¤è¯å¤±è´¥"å¹¶è·³è½¬åˆ°ç™»å½•é¡µé¢

**å½±å“èŒƒå›´**ï¼šé£ä¹¦OAuthé›†æˆæ— æ³•æ­£å¸¸å·¥ä½œ

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

ç»è¿‡æ·±å…¥æ’æŸ¥ï¼Œå‘ç°äº†**ä¸‰ä¸ªå±‚é¢çš„é—®é¢˜**ï¼š

### 1. JavaScriptè¿è¡Œæ—¶é”™è¯¯
- **ä½ç½®**ï¼š`/client/src/pages/feishu/auth.vue:288`
- **é—®é¢˜**ï¼šä½¿ç”¨äº†æœªå®šä¹‰çš„å¸¸é‡ `this.FEISHU_ERROR_CODES`
- **å½±å“**ï¼šé¡µé¢åŠ è½½æ—¶æŠ›å‡ºJavaScripté”™è¯¯ï¼Œå¯¼è‡´Vueç»„ä»¶æ— æ³•æ­£å¸¸æ¸²æŸ“

### 2. è·¯ç”±åç§°å†²çª
- **ä½ç½®**ï¼š`/client/src/router/index.js`
- **é—®é¢˜**ï¼šè·¯ç”±åç§° `feishuAuth` ä¸å…¶ä»–åŒ…å« `auth` çš„è·¯ç”±å­˜åœ¨æ½œåœ¨å†²çª
- **å½±å“**ï¼šè·¯ç”±åŒ¹é…å¯èƒ½ä¸å‡†ç¡®ï¼Œå¯¼è‡´è·¯ç”±å®ˆå«åˆ¤æ–­å¼‚å¸¸

### 3. Headerç»„ä»¶åŒé‡ç™»å½•æ£€æµ‹
- **ä½ç½®**ï¼š`/client/src/components/Header/hooks/useCurrMenu.ts:76`
- **é—®é¢˜**ï¼šHeaderç»„ä»¶æœ‰ç‹¬ç«‹çš„ç™»å½•æ£€æµ‹é€»è¾‘ï¼Œé£ä¹¦è·¯å¾„æœªè¢«æ’é™¤
- **å½±å“**ï¼šå³ä½¿è·¯ç”±å®ˆå«é€šè¿‡ï¼ŒHeaderç»„ä»¶ä»ä¼šå¼ºåˆ¶è·³è½¬åˆ°ç™»å½•é¡µé¢

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šJavaScripté”™è¯¯ä¿®å¤
**æ–‡ä»¶**ï¼š`client/src/pages/feishu/auth.vue:288`

**ä¿®å¤å‰**ï¼š
```javascript
const errorInfo = this.FEISHU_ERROR_CODES[result.errno] || {};
```

**ä¿®å¤å**ï¼š
```javascript
const errorInfo = getErrorInfo(result.errno);
```

### ä¿®å¤2ï¼šè·¯ç”±åç§°ä¼˜åŒ–
**æ–‡ä»¶**ï¼š`client/src/router/index.js`

**ä¿®å¤å†…å®¹**ï¼š
- `feishuAuth` â†’ `feishuLogin`
- `feishuTest` â†’ `feishuLoginTest`  
- `feishuDebug` â†’ `feishuLoginDebug`
- è·¯ç”±å®ˆå«ç™½åå•åŒæ­¥æ›´æ–°
- ç‰ˆæœ¬å·å‡çº§åˆ° `v6 (ä¿®å¤authå‘½åå†²çª)`

### ä¿®å¤3ï¼šHeaderç»„ä»¶ç™»å½•æ£€æµ‹æ’é™¤
**æ–‡ä»¶**ï¼š`client/src/components/Header/hooks/useCurrMenu.ts:76`

**ä¿®å¤å‰**ï¼š
```typescript
/(?<!(^\/|\/reg\/*|\/login\/*|\/forget\/*|\/authresult\/*|\/logout\/*|\/info\/.*|\/help\/*|\/help\/.*|\/404\/*|\/download\/*))$/i
```

**ä¿®å¤å**ï¼š
```typescript
/(?<!(^\/|\/reg\/*|\/login\/*|\/forget\/*|\/authresult\/*|\/logout\/*|\/info\/.*|\/help\/*|\/help\/.*|\/404\/*|\/download\/*|\/feishu\/.*))$/i
```

## ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤

### æ­¥éª¤1ï¼šåŸºç¡€è®¿é—®æµ‹è¯•
1. åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š`http://localhost:8058/feishu/auth`
2. **é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤ºé£ä¹¦ç™»å½•é¡µé¢ï¼Œè€Œä¸æ˜¯è·³è½¬åˆ°ç™»å½•é¡µé¢
3. **å¼‚å¸¸æƒ…å†µ**ï¼šå¦‚æœä»è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œæ‰§è¡Œæ­¥éª¤2

### æ­¥éª¤2ï¼šè·¯ç”±å®ˆå«æ—¥å¿—æ£€æŸ¥
1. è®¿é—®è°ƒè¯•é¡µé¢ï¼š`http://localhost:8058/router-debug`
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)ï¼Œåˆ‡æ¢åˆ° Console æ ‡ç­¾é¡µ
3. ç‚¹å‡»é¡µé¢ä¸Šçš„"æµ‹è¯• /feishu/auth"æŒ‰é’®
4. **é¢„æœŸæ—¥å¿—**ï¼š
   ```
   ğŸš€ è·¯ç”±å®ˆå«å¯åŠ¨ - ç‰ˆæœ¬2025-08-15-v6 (ä¿®å¤authå‘½åå†²çª): {
     to: "feishuLogin",
     toPath: "/feishu/auth",
     // ... å…¶ä»–ä¿¡æ¯
   }
   ğŸ” ç™½åå•æ£€æŸ¥: {
     targetRouteName: "feishuLogin",
     isInWhitelist: true,
     // ... å…¶ä»–ä¿¡æ¯
   }
   âœ… å…¬å¼€é¡µé¢ç›´æ¥æ”¾è¡Œ: feishuLogin
   ```
5. **å¼‚å¸¸æƒ…å†µ**ï¼šå¦‚æœç‰ˆæœ¬å·ä¸æ˜¯v6æˆ–è·¯ç”±åç§°ä¸æ˜¯feishuLoginï¼Œè¯´æ˜ä»£ç æœªæ­£ç¡®éƒ¨ç½²

### æ­¥éª¤3ï¼šå®Œæ•´æµç¨‹æµ‹è¯•
1. è®¿é—®ï¼š`http://localhost:8058/feishu/auth?code=test123&redirectUrl=/user`
2. **é¢„æœŸè¡Œä¸º**ï¼š
   - æ˜¾ç¤º"æ­£åœ¨éªŒè¯èº«ä»½..."åŠ è½½é¡µé¢
   - å‘èµ·APIè¯·æ±‚åˆ° `/api/isv/feishu/getuserinfo`
   - æ ¹æ®APIå“åº”æ˜¾ç¤ºç›¸åº”çŠ¶æ€ï¼ˆæˆåŠŸã€å¤±è´¥æˆ–éœ€è¦ç»‘å®šæ‰‹æœºå·ï¼‰

## ğŸ”„ å¤‡ç”¨æ–¹æ¡ˆ

å¦‚æœVueè·¯ç”±æ–¹æ¡ˆä»æœ‰é—®é¢˜ï¼Œå¯ä½¿ç”¨å·²éªŒè¯çš„é™æ€é¡µé¢æ–¹æ¡ˆï¼š

**é™æ€é¡µé¢åœ°å€**ï¼š`http://localhost:8058/feishu-auth.html`
- æ­¤æ–¹æ¡ˆå®Œå…¨ç‹¬ç«‹ï¼Œä¸ä¾èµ–Vueè·¯ç”±å’Œç»„ä»¶ç³»ç»Ÿ
- å·²é€šè¿‡å®Œæ•´æµ‹è¯•ï¼ŒåŠŸèƒ½æ­£å¸¸

## ğŸ“ æµ‹è¯•ç»“æœåé¦ˆæ ¼å¼

æµ‹è¯•å®Œæˆåï¼Œè¯·æŒ‰ä»¥ä¸‹æ ¼å¼åé¦ˆç»“æœï¼š

### âœ… æˆåŠŸæƒ…å†µ
```
æµ‹è¯•çŠ¶æ€ï¼šæˆåŠŸ âœ…
è®¿é—®é¡µé¢ï¼š/feishu/auth
å®é™…ç»“æœï¼šæ­£å¸¸æ˜¾ç¤ºé£ä¹¦ç™»å½•é¡µé¢
è·¯ç”±å®ˆå«ç‰ˆæœ¬ï¼šv6
æ§åˆ¶å°æ—¥å¿—ï¼šæ­£å¸¸
```

### âŒ å¤±è´¥æƒ…å†µ
```
æµ‹è¯•çŠ¶æ€ï¼šå¤±è´¥ âŒ
è®¿é—®é¡µé¢ï¼š/feishu/auth
å®é™…ç»“æœï¼š[å…·ä½“æè¿°çœ‹åˆ°çš„ç°è±¡]
è·¯ç”±å®ˆå«ç‰ˆæœ¬ï¼š[ä»æ§åˆ¶å°è·å–]
æ§åˆ¶å°æ—¥å¿—ï¼š[å¤åˆ¶ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯]
é”™è¯¯ä¿¡æ¯ï¼š[å¦‚æœæœ‰JavaScripté”™è¯¯ï¼Œè¯·æä¾›é”™è¯¯ä¿¡æ¯]
```

## ğŸ“š æŠ€æœ¯è¦ç‚¹æ€»ç»“

1. **å¤šå±‚æ£€æµ‹æœºåˆ¶**ï¼šVueåº”ç”¨ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªç™»å½•æ£€æµ‹ç‚¹ï¼ˆè·¯ç”±å®ˆå«ã€ç»„ä»¶Hookç­‰ï¼‰
2. **å‘½åå†²çªæ•æ„Ÿæ€§**ï¼šè·¯ç”±åç§°ä¸­çš„å…³é”®è¯å¯èƒ½å¯¼è‡´æ„å¤–çš„åŒ¹é…é—®é¢˜
3. **æ­£åˆ™è¡¨è¾¾å¼æ’é™¤**ï¼šç¡®ä¿æ‰€æœ‰éœ€è¦æ’é™¤çš„è·¯å¾„éƒ½åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ­£ç¡®é…ç½®
4. **è°ƒè¯•å·¥å…·é‡è¦æ€§**ï¼šåˆ›å»ºä¸“é—¨çš„è°ƒè¯•é¡µé¢æœ‰åŠ©äºå¿«é€Ÿå®šä½é—®é¢˜

## ğŸ”§ å¼€å‘ç¯å¢ƒä¿¡æ¯
- **ä»£ç è·¯å¾„**ï¼š`/Users/peakom/Documents/work/zai-fe`
- **æœåŠ¡åœ°å€**ï¼š`http://localhost:8058`
- **ä¿®å¤æ—¥æœŸ**ï¼š2025-08-15
- **ä¿®å¤ç‰ˆæœ¬**ï¼šè·¯ç”±å®ˆå« v6

---

*æ­¤æ–‡æ¡£å°†æ ¹æ®æµ‹è¯•ç»“æœæŒç»­æ›´æ–°*