# 考勤评估单条件高亮显示功能实现文档

## 功能概述

为考勤评估单表格中的迟到、早退、旷工、缺卡四个列添加条件高亮显示功能。当这些列的数值不为0时，以红色加粗样式突出显示，提高数据的可视化效果和用户体验。

## 修改文件清单

### 1. `/Users/peak/Work/Cloud/src/views/MyAttendance/Dialog/dialogHeader.js`
**功能**：表格列配置文件  
**修改类型**：配置更新

### 2. `/Users/peak/Work/Cloud/src/views/MyAttendance/Dialog/staffTimeItem.vue`
**功能**：考勤评估单主组件  
**修改类型**：模板和样式更新

## 详细修改内容

### 文件1：dialogHeader.js

**修改位置**：第21-40行  
**修改目的**：为需要高亮的列添加自定义slot配置

#### 修改前：
```javascript
{
  field_id: 'late_quantity',
  field_name: i18n.t('table112'), // 迟到
},
{
  field_id: 'early_quantity',
  field_name: i18n.t('table113'), // 早退
},
{
  field_id: 'absenteeism_quantity',
  field_name: i18n.t('table114'), // 旷工
},
{
  field_id: 'lack_quantity',
  field_name: i18n.t('table115'), // 缺卡
},
```

#### 修改后：
```javascript
{
  field_id: 'late_quantity',
  field_name: i18n.t('table112'), // 迟到
  slot: 'late_quantity',
},
{
  field_id: 'early_quantity',
  field_name: i18n.t('table113'), // 早退
  slot: 'early_quantity',
},
{
  field_id: 'absenteeism_quantity',
  field_name: i18n.t('table114'), // 旷工
  slot: 'absenteeism_quantity',
},
{
  field_id: 'lack_quantity',
  field_name: i18n.t('table115'), // 缺卡
  slot: 'lack_quantity',
},
```

**变更说明**：
- 为4个列添加了 `slot` 属性
- 启用自定义渲染模式，允许在Vue组件中定义自定义显示逻辑

### 文件2：staffTimeItem.vue

#### 修改1：模板更新（第16-56行）

**修改位置**：tableWrapper组件内部  
**修改目的**：添加自定义slot模板实现条件渲染

#### 修改前：
```vue
<tableWrapper
  class="table-info table-tatol"
  ref="tableWrapper"
  :row-key="true"
  :page="false"
  :showMore="false"
  :sortList.sync="sortList"
  :showTitle="true"
  :height="tableHeight"
  :notUseGbk="notUseGbk"
  :columns="tableHeader"
  :get-data="getTableList"
></tableWrapper>
```

#### 修改后：
```vue
<tableWrapper
  class="table-info table-tatol"
  ref="tableWrapper"
  :row-key="true"
  :page="false"
  :showMore="false"
  :sortList.sync="sortList"
  :showTitle="true"
  :height="tableHeight"
  :notUseGbk="notUseGbk"
  :columns="tableHeader"
  :get-data="getTableList"
>
  <!-- 迟到列高亮显示 -->
  <template slot-scope="{ row }" slot="late_quantity">
    <span :class="{ 'highlight-error': row.late_quantity && row.late_quantity !== '0' }">
      {{ row.late_quantity }}
    </span>
  </template>
  
  <!-- 早退列高亮显示 -->
  <template slot-scope="{ row }" slot="early_quantity">
    <span :class="{ 'highlight-error': row.early_quantity && row.early_quantity !== '0' }">
      {{ row.early_quantity }}
    </span>
  </template>
  
  <!-- 旷工列高亮显示 -->
  <template slot-scope="{ row }" slot="absenteeism_quantity">
    <span :class="{ 'highlight-error': row.absenteeism_quantity && row.absenteeism_quantity !== '0' }">
      {{ row.absenteeism_quantity }}
    </span>
  </template>
  
  <!-- 缺卡列高亮显示 -->
  <template slot-scope="{ row }" slot="lack_quantity">
    <span :class="{ 'highlight-error': row.lack_quantity && row.lack_quantity !== '0' }">
      {{ row.lack_quantity }}
    </span>
  </template>
</tableWrapper>
```

**变更说明**：
- 添加了4个自定义slot模板
- 使用Vue的作用域插槽 `slot-scope="{ row }"` 获取行数据
- 实现条件类名绑定：`{ 'highlight-error': condition }`
- 高亮条件：数值存在且不等于字符串'0'

#### 修改2：样式更新（第361-383行）

**修改位置**：样式部分  
**修改目的**：定义高亮显示的CSS样式

#### 修改前：
```less
<style lang="less" scoped>
.confirm-image {
  position: absolute;
  width: 200px;
  top: 40%;
  right: 45%;
}
/deep/ .table-tatol {
  .ivu-table-tbody {
    .ivu-table-row:last-child {
      font-weight: 700;
      color: #333c4b;
      font-size: 14px;
    }
  }
}
</style>
```

#### 修改后：
```less
<style lang="less" scoped>
.confirm-image {
  position: absolute;
  width: 200px;
  top: 40%;
  right: 45%;
}

.highlight-error {
  color: #f85d5d;
  font-weight: 600;
}

/deep/ .table-tatol {
  .ivu-table-tbody {
    .ivu-table-row:last-child {
      font-weight: 700;
      color: #333c4b;
      font-size: 14px;
    }
  }
}
</style>
```

**变更说明**：
- 新增 `.highlight-error` 样式类
- 设置高亮颜色：`#f85d5d`（红色）
- 设置字体粗细：`font-weight: 600`（加粗）

## 技术实现原理

### 1. Vue作用域插槽
- 使用 `slot-scope="{ row }"` 获取当前行数据
- 允许在模板中访问表格行的完整数据对象

### 2. 条件类名绑定
- 语法：`:class="{ 'class-name': condition }"`
- 当条件为真时应用CSS类，为假时移除

### 3. 数据类型兼容
- 条件判断：`row.field && row.field !== '0'`
- 兼容数字类型：`0`
- 兼容字符串类型：`'0'`
- 兼容空值：`null`, `undefined`, `''`

## 功能特性

### 高亮条件
- **触发条件**：数值不为0且不为空
- **支持数据类型**：
  - 数字：`1`, `2.5`, `-1`
  - 字符串：`"1"`, `"2.5"`, `"-1"`
  - 排除：`0`, `"0"`, `null`, `undefined`, `""`

### 视觉效果
- **颜色**：`#f85d5d`（红色）
- **字体**：加粗显示（`font-weight: 600`）
- **适用列**：迟到、早退、旷工、缺卡

### 用户体验提升
- **快速识别**：异常数据一目了然
- **视觉层次**：正常数据与异常数据形成对比
- **业务意义**：突出显示需要关注的考勤问题

## 代码质量保证

### 1. 可维护性
- 集中的样式定义，便于后续调整
- 清晰的注释标识各个功能模块

### 2. 扩展性
- 样式类可复用于其他需要高亮的场景
- slot模板模式可应用于其他表格列

### 3. 兼容性
- 兼容现有表格组件架构
- 不影响其他列的正常显示

## 测试建议

### 1. 数据测试
- 测试数值为0的情况：应显示正常样式
- 测试数值不为0的情况：应显示高亮样式
- 测试空值情况：应显示正常样式

### 2. 视觉测试
- 验证高亮颜色是否符合设计要求
- 确认字体加粗效果是否明显
- 检查整体表格视觉协调性

### 3. 功能测试
- 验证四个目标列均正确应用高亮逻辑
- 确认其他列不受影响
- 测试表格排序、筛选功能正常

## 总结

本次修改通过Vue的作用域插槽和条件类名绑定技术，成功实现了考勤评估单中异常数据的高亮显示功能。修改涉及配置文件和组件模板两个层面，保持了代码的整洁性和可维护性，提升了用户的数据查看体验。

## 修改历史

- **创建日期**：2025-08-17
- **修改人员**：开发团队
- **版本**：v1.0
- **关联提交**：待提交