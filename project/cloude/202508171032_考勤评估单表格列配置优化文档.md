# 考勤评估单表格列配置优化文档

## 功能概述

本次修改对考勤评估单表格进行了全面的列配置优化，主要包括：
1. 在最左边添加员工基本信息列（工号、姓名、岗位、部门）
2. 在病假右边新增3个假期类型列（带薪病假、年假、其它假别）
3. 在最右边添加夜班列
4. 创建新的国际化配置支持新增列的多语言显示

## 修改文件清单

### 1. 国际化配置文件
- `/Users/peak/Work/Cloud/src/i18n/langs/cn.js`
- `/Users/peak/Work/Cloud/src/i18n/langs/en.js`

### 2. 表格配置文件
- `/Users/peak/Work/Cloud/src/views/MyAttendance/Dialog/dialogHeader.js`

### 3. 组件文件
- `/Users/peak/Work/Cloud/src/views/MyAttendance/Dialog/staffTimeItem.vue`

## 详细修改内容

### 修改1：添加员工基本信息列

#### 位置：表格最左边
**新增列顺序**：工号 → 姓名 → 岗位 → 部门

#### 文件：dialogHeader.js（第5-20行）
```javascript
// 在 myTimeEvaluation 数组最前面添加：
{
  field_id: 'emp_id',
  field_name: i18n.t('table02'), // 工号
},
{
  field_id: 'name', 
  field_name: i18n.t('form02'), // 姓名
},
{
  field_id: 'job_name',
  field_name: i18n.t('table03'), // 岗位
},
{
  field_id: 'department',
  field_name: i18n.t('table05'), // 部门
},
```

#### 使用的国际化配置：
- `table02`：工号/Employee ID
- `form02`：姓名/Name
- `table03`：岗位/Job
- `table05`：部门/Department

### 修改2：新增假期类型列

#### 位置：病假列右边
**新增列顺序**：病假 → 带薪病假 → 年假 → 其它假别

#### 新增国际化配置

**cn.js（第2883-2885行）**：
```javascript
attendancePaidSick: '带薪病假',
attendanceAnnualLeave: '年假', 
attendanceOtherLeave: '其它假别',
```

**en.js（第2701-2703行）**：
```javascript
attendancePaidSick: 'Paid Sick Leave',
attendanceAnnualLeave: 'Annual Leave',
attendanceOtherLeave: 'Other Leave',
```

#### 文件：dialogHeader.js（第65-76行）
```javascript
// 在病假列后添加：
{
  field_id: 'paid_sick',
  field_name: i18n.t('attendancePaidSick'), // 带薪病假
},
{
  field_id: 'annual_leave',
  field_name: i18n.t('attendanceAnnualLeave'), // 年假
},
{
  field_id: 'other_leave', 
  field_name: i18n.t('attendanceOtherLeave'), // 其它假别
},
```

#### 字段命名规范：
- **字段名**：`paid_sick`, `annual_leave`, `other_leave`
- **显示名称**：不包含(H)单位标识的简洁版本

### 修改3：添加夜班列

#### 位置：表格最右边（加班异常列之后）

#### 新增国际化配置

**cn.js（第2886行）**：
```javascript
attendanceNightShift: '夜班',
```

**en.js（第2704行）**：
```javascript
attendanceNightShift: 'Night Shift',
```

#### 文件：dialogHeader.js（第97-100行）
```javascript
// 在表格最后添加：
{
  field_id: 'night_shift',
  field_name: i18n.t('attendanceNightShift'), // 夜班
},
```

### 修改4：组件配置更新

#### 文件：staffTimeItem.vue

**1. notUseGbk数组更新（第170-193行）**
```javascript
notUseGbk: [
  'emp_id',           // 新增：工号
  'name',             // 新增：姓名  
  'job_name',         // 新增：岗位
  'department',       // 新增：部门
  'date',
  'shift',
  'absence_quantity',
  // ... 其他字段
  'sick_quantity',
  'paid_sick',        // 新增：带薪病假
  'annual_leave',     // 新增：年假
  'other_leave',      // 新增：其它假别
  'work_quantity',
  'workday_quantity',
  'night_shift',      // 新增：夜班
],
```

**2. 合计计算更新（第281-290行）**
```javascript
// 在合计行对象中添加：
paid_sick: this.getTatolNum(res.data.list, 'paid_sick'),
annual_leave: this.getTatolNum(res.data.list, 'annual_leave'),
other_leave: this.getTatolNum(res.data.list, 'other_leave'),
// ... 其他字段
night_shift: this.getTatolNum(res.data.list, 'night_shift'),
```

## 完整的表格列顺序

修改后的表格列完整顺序如下：

| 序号 | 字段名 | 中文显示 | 英文显示 | 类型 |
|------|--------|----------|----------|------|
| 1 | emp_id | 工号 | Employee ID | 基本信息 |
| 2 | name | 姓名 | Name | 基本信息 |
| 3 | job_name | 岗位 | Job | 基本信息 |
| 4 | department | 部门 | Department | 基本信息 |
| 5 | date | 日期 | Date | 时间 |
| 6 | shift | 班次 | Shift | 班次 |
| 7 | shift_quantity | 班次时间 | Shift Hour | 班次 |
| 8 | work_quantity | 工作时间 | Working Hour | 工作 |
| 9 | late_quantity | 迟到 | Late | 异常(高亮) |
| 10 | early_quantity | 早退 | Early Leave | 异常(高亮) |
| 11 | absenteeism_quantity | 旷工 | Absenteeism | 异常(高亮) |
| 12 | lack_quantity | 缺卡 | Lack | 异常(高亮) |
| 13 | absence_quantity | 事假 | Personal Leave | 假期 |
| 14 | sick_quantity | 病假 | Sick Leave | 假期 |
| 15 | paid_sick | 带薪病假 | Paid Sick Leave | 假期(新增) |
| 16 | annual_leave | 年假 | Annual Leave | 假期(新增) |
| 17 | other_leave | 其它假别 | Other Leave | 假期(新增) |
| 18 | workday_quantity | 工作日加班 | Workday OT | 加班 |
| 19 | holiday_quantity | 周末加班 | Holiday OT | 加班 |
| 20 | public_holiday_quantity | 国假加班 | Public Holiday OT | 加班 |
| 21 | jbtx_quantity | 加班调休 | OT Rest | 加班 |
| 22 | jbyc_quantity | 加班异常 | OT Exception | 加班 |
| 23 | night_shift | 夜班 | Night Shift | 班次(新增) |

## 功能特性

### 1. 员工信息展示
- **目的**：便于识别每行数据对应的具体员工
- **位置**：表格最左边，确保优先显示
- **字段**：工号、姓名、岗位、部门

### 2. 假期类型细分
- **目的**：提供更详细的假期数据分析
- **新增假期**：带薪病假、年假、其它假别
- **位置**：在病假列后，保持假期相关列的集中性

### 3. 夜班数据统计
- **目的**：支持夜班工作时间的单独统计
- **位置**：表格最右边，作为补充信息

### 4. 国际化支持
- **完整的中英文支持**
- **语义清晰的显示名称**
- **不包含技术标识的用户友好显示**

## 数据处理说明

### 1. 格式化配置
所有新增字段都添加到 `notUseGbk` 数组中，确保：
- 文本字段（员工信息）不进行数字格式化
- 数值字段保持原始格式显示

### 2. 合计计算
新增的数值字段都包含在合计计算中：
- `paid_sick`：带薪病假合计
- `annual_leave`：年假合计  
- `other_leave`：其它假别合计
- `night_shift`：夜班合计

### 3. 高亮显示兼容
新增列与现有的异常数据高亮功能兼容，不影响迟到、早退、旷工、缺卡列的高亮显示。

## 技术实现亮点

### 1. 模块化配置
- 国际化配置集中管理
- 表格列配置与组件分离
- 便于后续维护和扩展

### 2. 命名规范
- 字段名使用下划线命名法
- 国际化key使用驼峰命名法并加前缀
- 保持代码风格一致性

### 3. 向后兼容
- 不影响现有功能
- 保持原有数据格式
- 支持增量数据更新

## 测试建议

### 1. 显示测试
- 验证所有新增列正确显示
- 确认中英文切换正常
- 检查列宽度和对齐效果

### 2. 数据测试  
- 测试员工基本信息显示
- 验证假期数据计算准确性
- 确认夜班数据统计正确

### 3. 功能测试
- 确认合计行计算正确
- 验证排序功能正常
- 测试表格导出功能

### 4. 兼容性测试
- 确认与现有高亮功能兼容
- 验证PDF导出功能正常
- 测试电子签名功能不受影响

## 总结

本次修改通过系统性的表格列配置优化，实现了：

1. **信息完整性提升**：增加员工基本信息，提高数据可读性
2. **数据分析精度提升**：细分假期类型，支持更精准的考勤分析
3. **功能覆盖面扩展**：增加夜班统计，适应多样化的工作时间安排
4. **用户体验优化**：清晰的列布局和完整的国际化支持

修改采用了模块化、可维护的代码结构，确保了系统的稳定性和可扩展性，为后续的功能增强奠定了良好基础。

## 修改历史

- **创建日期**：2025-08-17
- **修改人员**：开发团队
- **版本**：v1.0
- **关联提交**：待提交
- **影响范围**：考勤评估单模块