ğŸ”§ NestAPI æœåŠ¡å™¨é…ç½®æ€»ç»“

  1ï¸âƒ£ éƒ¨ç½²ä½ç½®

  /opt/ruizhu-app/nestapi-dist/
  - ç¼–è¯‘åçš„ NestJS åº”ç”¨ç¨‹åºï¼ˆJavaScript + ç±»å‹å®šä¹‰ï¼‰
  - åŒ…å«æ‰€æœ‰æ¨¡å—ï¼šauthã€productsã€bannersã€cartsã€categoriesã€collections ç­‰

---
  2ï¸âƒ£ ç¯å¢ƒå˜é‡é…ç½® (.env)

  # æ•°æ®åº“ - è…¾è®¯äº‘ CDB (Cloud Database)
  DB_HOST=gz-cdb-qtjza6az.sql.tencentcdb.com
  DB_USER=root
  DB_PASSWORD=Pp123456
  DB_NAME=mydb
  DB_PORT=27226

  # åº”ç”¨
  PORT=3000
  NODE_ENV=production

  # JWT è®¤è¯
  JWT_SECRET=your_jwt_secret_key
  JWT_EXPIRATION=7d

  # å¾®ä¿¡å°ç¨‹åºé…ç½®
  WECHAT_APP_ID=your_wechat_app_id
  WECHAT_APP_SECRET=your_wechat_app_secret

  å…³é”®ä¿¡æ¯ï¼š
  - æ•°æ®åº“ï¼šè…¾è®¯äº‘ MySQL CDB å®ä¾‹
  - åº”ç”¨è¿è¡Œç«¯å£ï¼š3000
  - ç¯å¢ƒï¼šç”Ÿäº§æ¨¡å¼ (NODE_ENV=production)

---
  3ï¸âƒ£ PM2 è¿›ç¨‹ç®¡ç†

  è¿›ç¨‹åç§°ï¼šruizhu-backend
  æ‰§è¡Œæ–‡ä»¶ï¼š/opt/ruizhu-app/nestapi-dist/main.js
  æ‰§è¡Œæ¨¡å¼ï¼šcluster_modeï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰
  Node.jsç‰ˆæœ¬ï¼š18.20.8
  çŠ¶æ€ï¼šonline
  é‡å¯æ¬¡æ•°ï¼š22 æ¬¡
  è¿è¡Œæ—¶é—´ï¼š16 åˆ†é’Ÿä»¥ä¸Š

  ç‰¹ç‚¹ï¼š
  - âœ“ ä½¿ç”¨ PM2 ç®¡ç†ï¼Œæ”¯æŒè‡ªåŠ¨é‡å¯
  - âœ“ é›†ç¾¤æ¨¡å¼è¿è¡Œï¼ˆå¤šè¿›ç¨‹ï¼‰
  - âœ“ é”™è¯¯æ—¥å¿—ï¼š/root/.pm2/logs/ruizhu-backend-error-16.log
  - âœ“ è¾“å‡ºæ—¥å¿—ï¼š/root/.pm2/logs/ruizhu-backend-out-16.log

---
  4ï¸âƒ£ Nginx åå‘ä»£ç†é…ç½®

  ç›‘å¬åœ°å€ï¼šhttps://yunjie.online (yunjie.online + www.yunjie.online)
  SSL è¯ä¹¦ï¼š/etc/caddy/certs/yunjie.online_bundle.crt
  SSL å¯†é’¥ï¼š/etc/caddy/certs/yunjie.online.key

  ä¸Šæ¸¸æœåŠ¡å™¨ï¼š
  upstream backend {
      server 127.0.0.1:3000;
  }

  è·¯ç”±é…ç½®ï¼š
  - /admin/ â†’ é™æ€æ–‡ä»¶ï¼Œalias: /opt/ruizhu-app/admin/
  - /api/ â†’ ä»£ç†åˆ° NestAPI (http://backend)
  - / â†’ ä»£ç†åˆ° NestAPI (http://backend)

  SSL åè®®ï¼š TLSv1.2ã€TLSv1.3

---
  5ï¸âƒ£ ç«¯å£ç›‘å¬çŠ¶æ€

  Port 80   â†’ HTTP é‡å®šå‘åˆ° HTTPS (nginx)
  Port 443  â†’ HTTPS æœåŠ¡ (nginx)
  Port 3000 â†’ NestAPI åº”ç”¨ (PM2/Node.js)

---
  6ï¸âƒ£ æ•°æ®åº“è¿æ¥ä¿¡æ¯

  ä¸»æœºï¼šgz-cdb-qtjza6az.sql.tencentcdb.com (è…¾è®¯äº‘)
  ç”¨æˆ·ï¼šroot
  å¯†ç ï¼šPp123456
  æ•°æ®åº“ï¼šmydb
  ç«¯å£ï¼š27226

---
  7ï¸âƒ£ å®Œæ•´çš„åº”ç”¨æ¶æ„

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚          HTTPS://yunjie.online                      â”‚
  â”‚              (åŸŸåè®¿é—®)                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Nginx åå‘ä»£ç†        â”‚
          â”‚ (:80 â†’ :443 é‡å®šå‘)     â”‚
          â”‚   (:443 HTTPS/SSL)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  è·¯ç”±åˆ†å‘                                  â”‚
          â”‚  /admin/  â†’ é™æ€æ–‡ä»¶ (/opt/.../admin/)  â”‚
          â”‚  /api/*   â†’ NestAPI (127.0.0.1:3000)    â”‚
          â”‚  /        â†’ NestAPI (127.0.0.1:3000)    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  NestAPI Application          â”‚
          â”‚  (:3000 PM2 Cluster Mode)    â”‚
          â”‚  - 2 ä¸ªå·¥ä½œè¿›ç¨‹                â”‚
          â”‚  - Node.js 18.20.8           â”‚
          â”‚  - è‡ªåŠ¨é‡å¯                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Tencent Cloud MySQL CDB      â”‚
          â”‚  Host: gz-cdb-*.sql.tencentcdbâ”‚
          â”‚  Port: 27226                  â”‚
          â”‚  Database: mydb               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

---
  8ï¸âƒ£ æ–‡ä»¶ç»“æ„

  /opt/ruizhu-app/
  â”œâ”€â”€ nestapi-dist/          # NestAPI ç¼–è¯‘åçš„ä»£ç 
  â”‚   â”œâ”€â”€ main.js           # PM2 å¯åŠ¨æ–‡ä»¶
  â”‚   â”œâ”€â”€ .env              # ç¯å¢ƒå˜é‡é…ç½®
  â”‚   â”œâ”€â”€ app.module.js
  â”‚   â”œâ”€â”€ auth/             # è®¤è¯æ¨¡å—
  â”‚   â”œâ”€â”€ products/         # äº§å“æ¨¡å—
  â”‚   â”œâ”€â”€ banners/          # è½®æ’­å›¾æ¨¡å—
  â”‚   â”œâ”€â”€ carts/            # è´­ç‰©è½¦æ¨¡å—
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ admin/                 # å‰ç«¯ç®¡ç†åå°ï¼ˆé™æ€æ–‡ä»¶ï¼‰
  â”‚   â”œâ”€â”€ index.html
  â”‚   â”œâ”€â”€ assets/
  â”‚   â””â”€â”€ vite.svg
  â””â”€â”€ ecosystem.config.js   # PM2 é…ç½®ï¼ˆæœªä½¿ç”¨ï¼Œç›´æ¥å¯åŠ¨ï¼‰

---
  9ï¸âƒ£ å¯åŠ¨å’Œç®¡ç†å‘½ä»¤

  # PM2 æŸ¥çœ‹çŠ¶æ€
  pm2 status

  # PM2 æŸ¥çœ‹æ—¥å¿—
  pm2 logs ruizhu-backend

  # PM2 é‡å¯æœåŠ¡
  pm2 restart ruizhu-backend

  # PM2 åœæ­¢æœåŠ¡
  pm2 stop ruizhu-backend

  # PM2 åˆ é™¤æœåŠ¡
  pm2 delete ruizhu-backend

---
  ğŸ”Ÿ ç³»ç»Ÿè¦æ±‚å’Œç‰ˆæœ¬ä¿¡æ¯

| é¡¹ç›®     | å€¼                 |
| -------- | ------------------ |
| Node.js  | 18.20.8            |
| PM2      | v6.0.13            |
| Nginx    | æœ€æ–°               |
| MySQL    | Tencent Cloud CDB  |
| è¿è¡Œç¯å¢ƒ | è…¾è®¯äº‘æœåŠ¡å™¨ Linux |

---
  å®Œå…¨å¯åŠ¨çŠ¶æ€ âœ…

  - NestAPI: online (PM2 cluster mode)
  - Nginx: online (serving on :80, :443)
  - Database: connected (Tencent Cloud CDB)
  - Admin Dashboard: https://yunjie.online/admin/
  - API Base: https://yunjie.online/api/